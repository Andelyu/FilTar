#!/bin/bash

rule pita:
        input:
            fasta_3UTR_merged="results/{species}_3UTR_chr{chrom}.fa.merged",
            mirnas="data/mirbase_mature_{species}.fa",
            script="src/PITA/pita_prediction.pl",
            bin="src/PITA/Bin",
            lib="src/PITA/lib"
        output:
            "results/{species}_chr{chrom}_pita_results.tab"
        benchmark:
             "benchmarks/{species}_chr{chrom}_pita.log"
        shell:
            "src/PITA/pita_prediction.pl -utr {input.fasta_3UTR_merged}  -mir {input.mirnas}  -prefix {wildcards.species}_chr{wildcards.chrom} && mv {wildcards.species}_chr{wildcards.chrom}_pita_results.tab {output}"

rule build_PITA_table:
        input:
             "create_PITA.sql"
        output:
            "results/PITA_created.txt"
        shell:
            "mysql -u tgac --password=tgac_bioinf -h tgac-db1.hpccluster bradleyt_filtar < {input} && touch {output}"

rule load_in_PITA_scores:
        input:
           PITA_results="results/{species}_chr{chrom}_pita_results.tab",
           script="src/load_PITA.sh"
        output:
           "results/{species}_chr{chrom}_loaded.PITA.txt"
        shell:
           "{input.script} {input.PITA_results} {wildcards.chrom} {wildcards.species}"
